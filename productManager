const fs = require('fs');
const productsObj = [
    {
      id: 1,
      title: 'Juguete de Spiderman',
      description: 'Juguete de Amazing Spiderman hecho por funko pop, coleccionable',
      price: 5000,
      thumbnail: '/hola/hola/hola',
      code: '001A',
      stock: 10,
    },
  ]

const asyncOperations = async() => {
  await fs.promises.writeFile('./products.json', JSON.stringify(productsObj,'\t'))
  //let resultado = await fs.promises.readFile('./products.json', 'utf-8')
  //console.log(JSON.parse(resultado))
  //await fs.promises.appendFile('./products.json', JSON.stringify(productsObj,'\t'))
  //resultado = await fs.promises.readFile('./products.json', 'utf-8')
  //console.log(JSON.parse(resultado))
  //await fs.promises.unlink('./products.json')
}

asyncOperations();

class ProductManager {
    constructor() {
      this.products = [];
      this.nextId = 1;
    }
  
    addProduct(title, description, price, thumbnail, code, stock) {
      if (!title || !description || !price || !thumbnail || !code || !stock) {
        console.error("Todos los campos son obligatorios");
        return;
      }
  
      const existingProduct = this.products.find((product) => product.code === code);
      if (existingProduct) {
        console.error("El cÃ³digo del producto ya existe");
        return;
      }
  
      const product = {
        id: this.nextId,
        title,
        description,
        price,
        thumbnail,
        code,
        stock
      };
      this.products.push(product);
      this.nextId++;
    }

    getProducts = async() => {
      let resultado = await fs.promises.readFile('./products.json', 'utf-8')
      console.log(JSON.parse(resultado))
      return this.products;
    }
  
    getProductById = async(id) => {
      let resultado = await fs.promises.readFile('./products.json', 'utf-8')
      const productsParse = JSON.parse(resultado)
      for(let product of productsParse){
        if(product.id === id){
          console.log("Producto Encontrado:", product);
          return product;
        } else {
          console.error("Producto no encontrado")
        }
      }
    }
  }

const productManager = new ProductManager();
productManager.addProduct("Juguete de Iron Man", "Juguete de Iron Man Funko Pop Coleccionable", 5000, "/ruta/de/imagen1.jpg", "001", 10);
console.log(productManager.getProductById(1))
console.log(productManager.getProducts())
